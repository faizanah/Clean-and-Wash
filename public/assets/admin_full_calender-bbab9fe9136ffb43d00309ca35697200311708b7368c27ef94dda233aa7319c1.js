function loadEvents(e,n,t,a){$.ajax({url:"/admin/events.json",dataType:"json",data:{start:moment(e).format("YYYY-MM-DD"),end:moment(n).format("YYYY-MM-DD")},success:function(e){console.log(e.events);a(e||[])}})}function removeEvent(e){console.log("Remove Event:"),calendar.fullCalendar("removeEvents",[e.id])}function appendEvent(e){console.log("Append Event:"),calendar.fullCalendar("renderEvent",e)}function updateEvent(e){calendar.fullCalendar("removeEvents",[e.id]),calendar.fullCalendar("renderEvent",e)}function new_event(e){var n=moment(e).format("DD-MM-YYYY HH:mm");console.log("Start:"+n),$.getScript("/admin/events/new?start="+n,function(){})}function edit_event(e){$.get(e.edit_url,function(){})}function update_event(e,n){if(confirm("Do you really want to update?")){var t={event:{id:e.id,start:moment(e.start).format("DD-MM-YYYY HH:mm"),end:moment(e.end).format("DD-MM-YYYY HH:mm")}};$.ajax({url:e.update_url,dataType:"json",data:t,type:"PATCH",success:function(e){console.log(JSON.stringify(e,null,2)),console.log(e.success),e.success?(flash_success(e.message),updateEvent(e.data)):(n(),$.each(e.errors,function(e,n){flash_error(n)}))},error:function(){n()}})}else n()}function fit_calendar_container_height(){if(neonCalendar2.isPresent)if(neonCalendar2.$sidebar.height()<neonCalendar2.$body.height())neonCalendar2.$sidebar.height(neonCalendar2.$body.height());else{var e=neonCalendar2.$sidebar.height();neonCalendar2.$sidebar.height(""),neonCalendar2.$sidebar.height()<neonCalendar2.$body.height()&&neonCalendar2.$sidebar.height(e)}}function reset_calendar_container_height(){neonCalendar2.isPresent&&neonCalendar2.$sidebar.height("auto")}function calendar_toggle_checkbox_status(e){neonCalendar2.$body.find('table tbody input[type="checkbox"]'+(e?"":":checked")).attr("checked",!e).click()}var calendar=$("#calendar"),neonCalendar2=neonCalendar2||{};!function(e,n){"use strict";e(document).ready(function(){if(neonCalendar2.$container=e(".calendar-env"),e.extend(neonCalendar2,{isPresent:neonCalendar2.$container.length>0}),neonCalendar2.isPresent){neonCalendar2.$sidebar=neonCalendar2.$container.find(".calendar-sidebar"),neonCalendar2.$body=neonCalendar2.$container.find(".calendar-body");var t=neonCalendar2.$body.find('table thead input[type="checkbox"], table tfoot input[type="checkbox"]');t.on("click",function(){t.attr("checked",this.checked).trigger("change"),calendar_toggle_checkbox_status(this.checked)}),neonCalendar2.$body.find('table tbody input[type="checkbox"]').on("change",function(){e(this).closest("tr")[this.checked?"addClass":"removeClass"]("highlight")}),e.isFunction(e.fn.fullCalendar)?(calendar.fullCalendar({buttonText:{today:"Today",month:"Month",week:"Week",day:"Day",list:"List"},header:{left:"title",right:"month,agendaWeek,agendaDay,listWeek today prev,next"},"default":"h(:mm)a",firstDay:1,height:600,droppable:!0,selectable:!0,selectHelper:!0,editable:!0,resizable:!0,eventLimit:!0,slotLabelFormat:"HH:mm",events:loadEvents,eventRender:function(e,n){""==!e.description&&n.find(".fc-title").append("<br/><span class='ultra-light'>"+e.description+"</span>")},eventResize:function(e,n,t,a){console.log("Event Resize: "),update_event(e,a)},eventDrop:function(e,n,t){console.log("Event Drop: "+e.end),update_event(e,t)},eventClick:function(t){function a(){e(".fc-popover.click").css({left:o.offset().left+o.outerWidth()/2,top:o.offset().top+o.outerHeight()})}console.log("Event Click: ");var o=e(this);if(e(this).hasClass("event-clicked")||(e(".fc-event").removeClass("event-clicked"),e(this).addClass("event-clicked")),e("body").append('<button type="button" class="close"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button><div class="fc-popover click"><div class="fc-header"><center>'+t.customer_name+'</center><button type="button" class="cl"><i class="entypo-cancel"></i></button></div><div class="fc-body"><p class="color-blue-grey"> Time:  <strong>'+moment(t.start).format("dddd, D YYYY, hh:mma")+'</strong></p><p class="color-blue-grey"> Customer:  <strong>'+t.customer_name+'</strong></p><p class="color-blue-grey"> Employee:  <strong>'+t.employee_name+'</strong></p>&nbsp;<a href= "#" class="fc-event-action-edit btn btn-primary event-edit">Edit event</a><a href= "#" class="fc-event-action-delete btn btn-primary">Delete event</a>'),e(".fc-event-action-delete").click(function(){e.ajax({url:"/admin/events/"+t.id,type:"DELETE",data:{_method:"DELETE"}})}),e(".fc-popover.click .datetimepicker").datetimepicker({widgetPositioning:{horizontal:"right"}}),e(".fc-popover.click .datetimepicker-2").datetimepicker({widgetPositioning:{horizontal:"right"},format:"LT",debug:!0}),a(),e(".fc-scroller, .calendar-page-content, body").scroll(function(){a()}),e(n).resize(function(){a()}),e(".fc-popover.click").length>1)for(var r=0;r<e(".fc-popover.click").length-1;r++)e(".fc-popover.click").eq(r).remove();e(".fc-popover.click .cl, .fc-popover.click .remove-popover").click(function(){e(".fc-popover.click").remove(),e(".fc-event").removeClass("event-clicked")}),e(".fc-event-action-edit").click(function(n){n.preventDefault(),e(".fc-popover.click .main-screen").hide(),edit_event(t)}),e(".fc-event-action-remove").click(function(n){n.preventDefault(),e(".fc-popover.click .main-screen").hide(),e(".fc-popover.click .remove-confirm").show()})},select:function(e){new_event(e),calendar.fullCalendar("unselect")},drop:function(){console.log("Event Drop Trigger."),new_event()}}),e("#draggable_events").find("li a").draggable({zIndex:999,revert:!0,revertDuration:0}).on("click",function(){return!1})):alert("Please include full-calendar script!"),e("body").on("submit","#add_event_form",function(n){n.preventDefault();var t=e("#add_event_form input");if(0==t.val().length)return!1;var a=["","color-green","color-blue","color-orange","color-primary",""],o=a[Math.floor(a.length*Math.random())],r=e('<li><a href="#"></a></li>');return r.find("a").text(t.val()).addClass(o).attr("data-event-class",o),r.appendTo(e("#draggable_events")),e("#draggable_events li a").draggable({zIndex:999,revert:!0,revertDuration:0}).on("click",function(){return!1}),fit_calendar_container_height(),r.hide().slideDown("fast"),t.val(""),!1})}})}(jQuery,window);